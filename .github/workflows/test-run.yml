name: ì¿ íŒ¡ íŒŒíŠ¸ë„ˆìŠ¤ ìë™í™”

on:
  workflow_dispatch:
  schedule:
    - cron: '0 0 * * *'

jobs:
  test-dummy:
    name: 1ë‹¨ê³„ - ë”ë¯¸ ë°ì´í„° í…ŒìŠ¤íŠ¸
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.10'
      - name: ë”ë¯¸ í…ŒìŠ¤íŠ¸
        run: python test_coupang_logic.py

  coupang-api:
    name: 2ë‹¨ê³„ - ì¿ íŒ¡ API ì‹¤í–‰
    runs-on: ubuntu-latest
    needs: test-dummy
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.10'
      
      - name: requests ì„¤ì¹˜
        run: pip install requests
      
      - name: ì¿ íŒ¡ ì œí’ˆ ì°¾ê¸°
        env:
          COUPANG_ACCESS_KEY: ${{ secrets.COUPANG_ACCESS_KEY }}
          COUPANG_SECRET_KEY: ${{ secrets.COUPANG_SECRET_KEY }}
        run: python coupang_smart_finder.py | tee result.txt
      
      - name: í…”ë ˆê·¸ë¨ ì•Œë¦¼
        if: always()
        run: |
          TIME=$(date '+%Y-%m-%d %H:%M')
          
          MESSAGE="âœ… ì¿ íŒ¡ ìë™í™” ì™„ë£Œ
          
          ğŸ“… ${TIME}
          ğŸ“Š ê²°ê³¼ í™•ì¸: https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}"
          
          curl -X POST \
            "https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage" \
            -d "chat_id=${{ secrets.TELEGRAM_CHAT_ID }}" \
            -d "text=${MESSAGE}"
